name: Weekly LinkedIn Auto Post

on:
  schedule:
    # Runs every Sunday at 5:00 PM NZST
    - cron: '0 5 * * 0'  # 5:00 AM UTC = 6:00 PM NZDT / 5:00 PM NZST
  
  # Allow manual triggering
  workflow_dispatch:

jobs:
  post-to-linkedin:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Post to LinkedIn
      run: |
        # Create the LinkedIn post content
        POST_CONTENT='ðŸš€ Ready to accelerate your AI learning journey?

        Join the AI Builders Community where we turn curiosity into capability through hands-on collaborative projects!

        âœ¨ What makes us different:
        â€¢ Use case-driven learning (no more tutorial hell!)
        â€¢ Structured pathway from Explorer to Builder  
        â€¢ Real-world projects with mockups & wireframes
        â€¢ Safe learning space free of judgment
        â€¢ Community of like-minded AI enthusiasts

        Whether you'\''re a complete beginner or looking to upskill, we meet you where you are and help you reach where you want to go.

        ðŸŽ¯ Ready to build your AI future?

        #AI #ArtificialIntelligence #AILearning #TechCommunity #SkillDevelopment #AIEducation #ProductFoundry #FutureOfWork #MachineLearning #Innovation'

        # Create JSON payload for LinkedIn API
        JSON_PAYLOAD=$(cat <<EOF
        {
          "author": "urn:li:person:LFmKmXorjj",
          "lifecycleState": "PUBLISHED",
          "specificContent": {
            "com.linkedin.ugc.ShareContent": {
              "shareCommentary": {
                "text": "$POST_CONTENT"
              },
              "shareMediaCategory": "NONE"
            }
          },
          "visibility": {
            "com.linkedin.ugc.MemberNetworkVisibility": "PUBLIC"
          }
        }
        EOF
        )

        # Post to LinkedIn API
        RESPONSE=$(curl -s -X POST "https://api.linkedin.com/v2/ugcPosts" \
          -H "Authorization: Bearer ${{ secrets.LINKEDIN_ACCESS_TOKEN }}" \
          -H "Content-Type: application/json" \
          -d "$JSON_PAYLOAD")

        echo "LinkedIn API Response: $RESPONSE"

        # Check if post was successful
        if echo "$RESPONSE" | grep -q '"id"'; then
          echo "âœ… LinkedIn post created successfully!"
          
          # Create success issue for tracking
          gh issue create \
            --title "âœ… LinkedIn Post Created - $(date '+%Y-%m-%d')" \
            --body "LinkedIn post was automatically created on $(date).

          **Post Content:**
          $POST_CONTENT

          **API Response:**
          \`\`\`json
          $RESPONSE
          \`\`\`" \
            --label "linkedin,automated,success"
        else
          echo "âŒ LinkedIn post failed!"
          
          # Create failure issue for debugging
          gh issue create \
            --title "âŒ LinkedIn Post Failed - $(date '+%Y-%m-%d')" \
            --body "LinkedIn post failed on $(date).

          **Error Response:**
          \`\`\`json
          $RESPONSE
          \`\`\`

          Please check the LinkedIn access token and API configuration." \
            --label "linkedin,automated,error"
          
          exit 1
        fi
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}